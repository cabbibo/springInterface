<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  
<script src="lib/jquery-1.7.1.min.js">                  </script>
<script src="lib/leap.min.js">                          </script>
<script src="lib/stats.min.js">                         </script>
<script src="lib/underscore.js">                        </script>
<script src="lib/math.js">                              </script>

<script src="lib/three.min.js">                         </script>
<script src="lib/OrbitControls.js">                     </script>

<script src="lib/d3.v3.min.js">                            </script>
<script src="lib/d3.parcoords.js">                     </script>

<script src = "threeInit.js">                           </script>
<script src = "Mass.js">                                </script>
<script src = "MassController.js">                      </script>
<script src = "Spring.js">                              </script>
<script src = "SpringController.js">                    </script>
<script src = "Apps.js">                                </script>

<link rel="stylesheet" href="lib/d3.parcoords.css"/>

<style>
  body{
    background:#000;
    margin:0px;
    overflow: hidden;
  }
  #parcoords {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 135px;
    background: rgba(0,0,0,0.8);
  }
  .parcoords text {
    fill: rgba(255,255,255,0.35);
    font-size: 9px;
  }
  .parcoords .axis line, .parcoords .axis path {
    stroke: rgba(125,125,125,0.22);
    shape-rendering: default;
    stroke-width: 1px;
  }
  .parcoords .axis text {
  }

</style>

</head>
<body>
  <div id="parcoords" class="parcoords"></div>
  <div id="container"></div>

  <script>

    // Scene Size
    var SS = 1000;

    var clock, controls, camera, scene, container, renderer, stats;

    var massController , masses = [];

    var springController , springs = [];

    var theta = 0;

    // Parallel coordinates
    var color = function(d) {
      // color by total force
      var red = 55+Math.round(200*d.totalF/500);
      var alpha = 0.2+d.totalF/3000;
      if (red > 255) red = 255;
      if (alpha > 1) alpha = 1;
      return "rgba(" + red + ",35,35," + alpha + ")";
    };

    var parcoords = d3.parcoords()("#parcoords")
      .color(color);

    init();


    function init(){


      threeInit(SS);

      light = new THREE.DirectionalLight( 0x04819E, 1 );
      light.position.set( 0, 0, 1 );
      scene.add( light );

      light = new THREE.DirectionalLight( 0xFF1E00, 1 );
      light.position.set( 0, 1, 0 );
      scene.add( light );

      light = new THREE.DirectionalLight( 0xFFB100, 1 );
      light.position.set( 1, 0, 0 );
      scene.add( light );

      massController    = new MassController({
       friction: .75 
      });
      springController  = new SpringController();

      springController.createSprings({
        type: "Game",
        //flatten: true,
      });
      
      start();

    }
    
    
    var frame = 0;
    function update(){

      // Applies forces
      springController.update();

      // Than moves forces
      massController.update();

      springs = springController.springs.map(function(d) {
        var F = d.getForce();
        var totalF = Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);
        return {
          k: d.k,
          l: d.l,
          totalF: totalF,
          x1: d.m1.position.x,
          vx1: d.m1.velocity.x,
          Fx: F.x,
          vx2: d.m2.velocity.x,
          x2: d.m2.position.x,
          y1: d.m1.position.y,
          vy1: d.m1.velocity.y,
          Fy: F.y,
          vy2: d.m2.velocity.y,
          y2: d.m2.position.y,
          z1: d.m1.position.z,
          vz1: d.m1.velocity.z,
          Fz: F.z,
          vz2: d.m2.velocity.z,
          z2: d.m2.position.z,
        };
      });

      parcoords.data(springs)
        .autoscale()
        .render();

      if (frame % 3 == 0) parcoords.createAxes(); // update axes periodically
      frame++;
    }



  </script>

</body>
</html>



